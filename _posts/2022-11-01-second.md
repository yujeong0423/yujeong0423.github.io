알테어를 활용한 탐색적 데이터 시각화
===

(Explorative Data Visualization with Altair)
===

![altair](https://user-images.githubusercontent.com/10287629/138803189-907e3229-ba81-49c1-be97-0df36a01f013.png)

<div style="page-break-after: always;"></div>

# 5장. 다중 뷰 구성

- 다수 필드로 구성된 데이터의 시각화에 대하여 생각해 보자.   
  - (`x`, `y`, `color`, `size`, `shape` 등과 같은) 시각적 인코딩 채널을 최대한 많이 사용하고 싶을 수 있다. 
  - 하지만 인코딩 채널의 수가 증가할수록 차트는 복잡하고 이해하기 어려워진다. 
  - 단일 차트에 "과부하"를 거는 방식보다는,  
    **다중 차트**로 구성하여 비교하기 좋도록 만드는 방식이 좋다. 
- 본 장에서는 **다중 뷰 구성**을 위한 다양한 방법을 공부한다. 
  - **층(layer)**: 호환되는 차트를 서로 겹쳐서 층을 구성
  - **면(facet)**: 데이터를 다수 차트로 구성하여 행이나 열을 구성
  - **병합(concatenate)**: 단일 공유 레이아웃 내부에 임의 차트가 위치하도록 구성
  - **반복(repeat)**: 기본 차트 명세를 다수 데이터 필드에 적용
- 이러한 작업을 처리하는 **뷰 구성 연산자** 사용법을 살펴 볼 예정이다.  
  복잡한 다중 뷰 구성을 만드는 연산의 수행 방법을 공부하자. 
- *이 노트북은 [data visualization curriculum](https://github.com/uwdata/visualization-curriculum)의 일부이다.*


```python
import pandas as pd
import altair as alt
```

- 월 이름 등을 우리나라 [로케일](https://ko.wikipedia.org/wiki/로케일)에 맞게 출력하려면, 아래와 같이 로케일을 설정해야 한다.  


```python
from urllib import request
import json

# 한국 로케일 형식을 가져와서 활성화
with request.urlopen('https://raw.githubusercontent.com/d3/d3-format/master/locale/ko-KR.json') as f:
  ko_format = json.load(f)
with request.urlopen('https://raw.githubusercontent.com/d3/d3-time-format/master/locale/ko-KR.json') as f:
  ko_time_format = json.load(f)
alt.renderers.set_embed_options(formatLocale=ko_format, timeFormatLocale=ko_time_format)
```




    RendererRegistry.enable('default')



## 1. 기상 데이터

- 시애틀과 뉴욕에 대한 기상 통계를 시각화할 것이다.  
  데이터 세트를 적재하고 처음 및 마지막 10 행을 살펴보자.


```python
weather = 'https://vega.github.io/vega-datasets/data/weather.csv'
```

- location: 시애틀 또는 뉴욕
- date: (2012-01-01 ~ 2015-12-31) 1,461 일
- precipitation: 강수량
- temp_max, temp_min: 일별 최저 기온 및 최고 기온 
- wind: 풍속
- weather: 날씨를 묘사하는 단어


```python
df = pd.read_csv(weather)
df.head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>date</th>
      <th>precipitation</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>wind</th>
      <th>weather</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Seattle</td>
      <td>2012-01-01</td>
      <td>0.0</td>
      <td>12.8</td>
      <td>5.0</td>
      <td>4.7</td>
      <td>drizzle</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Seattle</td>
      <td>2012-01-02</td>
      <td>10.9</td>
      <td>10.6</td>
      <td>2.8</td>
      <td>4.5</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Seattle</td>
      <td>2012-01-03</td>
      <td>0.8</td>
      <td>11.7</td>
      <td>7.2</td>
      <td>2.3</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Seattle</td>
      <td>2012-01-04</td>
      <td>20.3</td>
      <td>12.2</td>
      <td>5.6</td>
      <td>4.7</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Seattle</td>
      <td>2012-01-05</td>
      <td>1.3</td>
      <td>8.9</td>
      <td>2.8</td>
      <td>6.1</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Seattle</td>
      <td>2012-01-06</td>
      <td>2.5</td>
      <td>4.4</td>
      <td>2.2</td>
      <td>2.2</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Seattle</td>
      <td>2012-01-07</td>
      <td>0.0</td>
      <td>7.2</td>
      <td>2.8</td>
      <td>2.3</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Seattle</td>
      <td>2012-01-08</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>2.8</td>
      <td>2.0</td>
      <td>sun</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Seattle</td>
      <td>2012-01-09</td>
      <td>4.3</td>
      <td>9.4</td>
      <td>5.0</td>
      <td>3.4</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Seattle</td>
      <td>2012-01-10</td>
      <td>1.0</td>
      <td>6.1</td>
      <td>0.6</td>
      <td>3.4</td>
      <td>rain</td>
    </tr>
  </tbody>
</table>
</div>



- location: 시애틀 또는 뉴욕
- date: (2012-01-01 ~ 2015-12-31) 1,461 일
- precipitation: 강수량
- temp_max, temp_min: 일별 최저 기온 및 최고 기온 
- wind: 풍속
- weather: 날씨를 묘사하는 단어


```python
df.tail(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>date</th>
      <th>precipitation</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>wind</th>
      <th>weather</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2912</th>
      <td>New York</td>
      <td>2015-12-22</td>
      <td>4.8</td>
      <td>15.6</td>
      <td>11.1</td>
      <td>3.8</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2913</th>
      <td>New York</td>
      <td>2015-12-23</td>
      <td>29.5</td>
      <td>17.2</td>
      <td>8.9</td>
      <td>4.5</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2914</th>
      <td>New York</td>
      <td>2015-12-24</td>
      <td>0.5</td>
      <td>20.6</td>
      <td>13.9</td>
      <td>4.9</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2915</th>
      <td>New York</td>
      <td>2015-12-25</td>
      <td>2.5</td>
      <td>17.8</td>
      <td>11.1</td>
      <td>0.9</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2916</th>
      <td>New York</td>
      <td>2015-12-26</td>
      <td>0.3</td>
      <td>15.6</td>
      <td>9.4</td>
      <td>4.8</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2917</th>
      <td>New York</td>
      <td>2015-12-27</td>
      <td>2.0</td>
      <td>17.2</td>
      <td>8.9</td>
      <td>5.5</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2918</th>
      <td>New York</td>
      <td>2015-12-28</td>
      <td>1.3</td>
      <td>8.9</td>
      <td>1.7</td>
      <td>6.3</td>
      <td>snow</td>
    </tr>
    <tr>
      <th>2919</th>
      <td>New York</td>
      <td>2015-12-29</td>
      <td>16.8</td>
      <td>9.4</td>
      <td>1.1</td>
      <td>5.3</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2920</th>
      <td>New York</td>
      <td>2015-12-30</td>
      <td>9.4</td>
      <td>10.6</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>rain</td>
    </tr>
    <tr>
      <th>2921</th>
      <td>New York</td>
      <td>2015-12-31</td>
      <td>1.5</td>
      <td>11.1</td>
      <td>6.1</td>
      <td>5.5</td>
      <td>rain</td>
    </tr>
  </tbody>
</table>
</div>




```python
df.describe(include='all')
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>location</th>
      <th>date</th>
      <th>precipitation</th>
      <th>temp_max</th>
      <th>temp_min</th>
      <th>wind</th>
      <th>weather</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2922</td>
      <td>2922</td>
      <td>2922.000000</td>
      <td>2922.000000</td>
      <td>2922.000000</td>
      <td>2922.000000</td>
      <td>2922</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>2</td>
      <td>1461</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5</td>
    </tr>
    <tr>
      <th>top</th>
      <td>Seattle</td>
      <td>2012-01-01</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>sun</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>1461</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1466</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.944764</td>
      <td>16.769131</td>
      <td>8.612320</td>
      <td>4.101129</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>7.695286</td>
      <td>8.644596</td>
      <td>7.511776</td>
      <td>1.880791</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>min</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>-7.700000</td>
      <td>-16.000000</td>
      <td>0.400000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>10.000000</td>
      <td>3.300000</td>
      <td>2.700000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>16.100000</td>
      <td>8.900000</td>
      <td>3.800000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.800000</td>
      <td>23.900000</td>
      <td>13.900000</td>
      <td>5.100000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>max</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>118.900000</td>
      <td>37.800000</td>
      <td>26.700000</td>
      <td>16.200000</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>



- 두 도시의 기상에 대한 단독 및 교차 시각화를 다중 뷰로 만들어 보자. 

## 2. 레이어

- 여러 차트를 결합하는 가장 일반적인 방법 중 하나는 **층(layer)** 마크를 겹쳐서 결합하는 것이다.  
  - 차트들의 스케일 도메인이 호환된다면, 병합하여 __공유 축__ 구성이 가능하다. 
  - `x` 또는 `y` 인코딩 중 하나라도 호환되지 않는다면,  
    별도의 스케일과 축을 사용하여 마크를 겹치는 __이중-축(dual-axis) 차트__ 생성이 가능하다.

### 2.1 축 공유

- 우선 월별로 평균 기온의 최소값과 최대값을 시각화 해 보자. 


```python
alt.Chart(weather).mark_area().encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_max):Q'),  # 월별 기온 최대값      
  alt.Y2('average(temp_min):Q')  # 월별 기온 최소값
)
```





<div id="altair-viz-7baf0b4edd9e451b99a16706cf21387a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7baf0b4edd9e451b99a16706cf21387a") {
      outputDiv = document.getElementById("altair-viz-7baf0b4edd9e451b99a16706cf21387a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "area", "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 시각화 결과를 통하여 전체 데이터의 월별 온도 범위를 알 수 있다.  
  하지만 이 온도 범위는 시애틀(미국의 서쪽 끝)과 뉴욕(미국의 동쪽 끝) 데이터를  
  섞어서 집계한 결과이므로 오해를 유도할 가능성이 있다.
  ![seattle2NY](https://user-images.githubusercontent.com/10287629/137833161-578faf70-ed66-426e-a2a4-6ad27bff937e.png)
- 색상 인코딩을 사용하여 도시 별로 데이터를 분할하고,  
  겹치는 영역을 수용하기 위해 마크 투명도를 조정하자.


```python
alt.Chart(weather).mark_area(opacity=0.3).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_max):Q'),
  alt.Y2('average(temp_min):Q'),  
  alt.Color('location:N')         # 도시 별로 색상 구분 
)
```





<div id="altair-viz-4f756f30389e43a4b40394b1023624c7"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-4f756f30389e43a4b40394b1023624c7") {
      outputDiv = document.getElementById("altair-viz-4f756f30389e43a4b40394b1023624c7");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 시애틀이 더 온화하다: 겨울에는 따듯하고, 여름에는 시원하다. 
- 이는 레이어드 차트(layered chart)로 시각화 한 경우이다.  
  - 영역(area) 마크를 색상으로 구분하였을 뿐이다. 
  - 도시별 기온 범위를 보여주되, 중첩되는 영역을 강조하였다. 
- 과제
  - 두 도시의 월별 평균 기온 범위를 별도의 차트로 시각화하여 비교하여 보라. 
  - 두 도시를 통합적으로 시각화한 위 차트와 비교하여 보라. 

- 도시별로 최소/최대 기온의 중간점을 보여주는 꺽은선 차트를 만들어 보자.  
  최소 기온과 최대 기온의 평균값을 계산하기 위해 `calculate` 변환을 사용한다.


```python
alt.Chart(weather).mark_line().transform_calculate(   # calculate 변환
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'  # 일별 중간 기온 계산
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),                       # 일별 중간 기온의 평균치 집계 
  alt.Color('location:N')
)
```





<div id="altair-viz-29d95f08f5c3460fa7af2e01c0668dd0"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-29d95f08f5c3460fa7af2e01c0668dd0") {
      outputDiv = document.getElementById("altair-viz-29d95f08f5c3460fa7af2e01c0668dd0");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 계산 변환 내에서 `+datum.temp_min`의 사용에 주목하라.  
  - 특별한 파싱 명령 없이 데이터를 직접 적재할 때,  
    기온 값은 내부적으로 (수치가 아닌) 문자열 값으로 적재될 수 있다.  
  - 값 앞에 `+`를 더하면 수치로 취급된다.


```python
alt.Chart(weather).mark_line().transform_calculate(   
  temp_mid='(datum.temp_min + datum.temp_max) / 2'    # + 기호 없이 사용하면 원하는 결과를 얻을 수 없음
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),                        
  alt.Color('location:N')
)
```





<div id="altair-viz-883a6beab7734607a18e2f1dcd74d630"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-883a6beab7734607a18e2f1dcd74d630") {
      outputDiv = document.getElementById("altair-viz-883a6beab7734607a18e2f1dcd74d630");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(datum.temp_min + datum.temp_max) / 2", "as": "temp_mid"}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 이제 범위 영역과 중간점 꺽은선을 겹쳐서 이 차트를 결합하고 싶다.  
  `chart1 + chart2`라는 문법을 사용하여,  
  `chart1`을 첫번째 층에 표시하고, `chart2`를 두번째 층으로 상단에 표시할 수 있다. 


```python
tempMinMax = alt.Chart(weather).mark_area(opacity=0.3).encode(  # 영역 마크
  alt.X('month(date):T'),
  alt.Y('average(temp_max):Q'),
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart(weather).mark_line().transform_calculate(  # 꺽은선 마크
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),
  alt.Color('location:N')
)

tempMinMax + tempMid                                           # `+` 연산자로 다중 뷰 구성 
```





<div id="altair-viz-60d71072c9f3469da50ae487f5c83338"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-60d71072c9f3469da50ae487f5c83338") {
      outputDiv = document.getElementById("altair-viz-60d71072c9f3469da50ae487f5c83338");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 다층 플롯을 완성했다! 그러나 y축 제목은 좀 길고 어설프다...
- 결과를 정리하기 위해 축을 맞춤화하자.  
  여러 층 중의 하나에서 맞춤형 축 제목을 설정하면, 자동적으로 모든 층에 대하여 공유된다.


```python
tempMinMax = alt.Chart(weather).mark_area(opacity=0.3).encode(
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),  # x-축 및 눈금 제목 설정 
  alt.Y('average(temp_max):Q', title='평균 기온 (°C)'),              # y-축 제목 설정 
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart(weather).mark_line().transform_calculate(
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),
  alt.Color('location:N')
)

tempMinMax + tempMid
```





<div id="altair-viz-e2061def53594c4eaea39ac8a7597d8d"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-e2061def53594c4eaea39ac8a7597d8d") {
      outputDiv = document.getElementById("altair-viz-e2061def53594c4eaea39ac8a7597d8d");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 위 차트에서 두 층 모두에 맞춤형 축 제목을 지정하면 어떻게 될까? 


```python
tempMinMax = alt.Chart(weather).mark_area(opacity=0.3).encode(
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),   # x-축 및 눈금 제목 설정 
#   alt.X('month(date):T', title='month', axis=alt.Axis(format='%b')),  # x-축 및 눈금 제목 설정 
  alt.Y('average(temp_max):Q', title='평균 기온 (°C)'),                 # y-축 제목 설정 
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart(weather).mark_line().transform_calculate(
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T', title='월', axis=alt.Axis(format='%b')),    # x-축 및 눈금 제목 설정
#   alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),     # x-축 및 눈금 제목 설정
  alt.Y('average(temp_mid):Q', title='average temperature (°C)'),     # y-축 제목 설정 
  alt.Color('location:N')
)

tempMinMax + tempMid
```





<div id="altair-viz-64c0980cef994c66917a29f4bb0ceab0"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-64c0980cef994c66917a29f4bb0ceab0") {
      outputDiv = document.getElementById("altair-viz-64c0980cef994c66917a29f4bb0ceab0");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": "\uc6d4", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "title": "average temperature (\u00b0C)", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 다층으로 겹쳐지는 차트에서 축 제목을 층마다 각기 지정하면, 
  - 각 층의 제목이 쉼표로 구분되어 모두 표시된다. 
  - 어느 한 층이라도 `title=None`으로 지정하면, 제목이 표시되지 않는다.  

- 앞에서 `+` 연산자를 써서 두 차트를 다층으로 겹치는 방법을 공부했다.  
  이 `+` 연산자는 알테어 `layer` 메소드에 대한 약식 표기법을 제공한다. 


```python
alt.layer(tempMinMax, tempMid)
```





<div id="altair-viz-832accac682c4f448d2158186bfb210d"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-832accac682c4f448d2158186bfb210d") {
      outputDiv = document.getElementById("altair-viz-832accac682c4f448d2158186bfb210d");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": "\uc6d4", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "title": "average temperature (\u00b0C)", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>




```python
alt.layer(tempMid, tempMinMax)
```





<div id="altair-viz-2ad5adbe6a3a498598f1ac5e7a2c2dd8"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-2ad5adbe6a3a498598f1ac5e7a2c2dd8") {
      outputDiv = document.getElementById("altair-viz-2ad5adbe6a3a498598f1ac5e7a2c2dd8");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": "\uc6d4", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "title": "average temperature (\u00b0C)", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}, {"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 다층으로 겹치는 방식에서는 나중에 지정한 층이 이전 층 위에 겹쳐지므로 순서가 중요하다.  
  앞의 다층 차트에서 층을 지정하는 순서를 변경해보라. (힌트: `line` 마크의 색상을 자세히 살펴보라.)


```python
tempMinMax = alt.Chart(weather).mark_area(opacity=0.9).encode(     # 투명도를 약하게 조절
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),   
  alt.Y('average(temp_max):Q', title='평균 기온 (°C)'),             
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart(weather).mark_line().transform_calculate(
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),
  alt.Color('location:N')
)

tempMid + tempMinMax                                               # 층 지정 순서를 변경 
```





<div id="altair-viz-67ec6b3183604ab6ac12653a4a506406"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-67ec6b3183604ab6ac12653a4a506406") {
      outputDiv = document.getElementById("altair-viz-67ec6b3183604ab6ac12653a4a506406");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}, {"mark": {"type": "area", "opacity": 0.9}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>




```python
tempMinMax + tempMid
```





<div id="altair-viz-af532d8dc5ea4fb195e3f4f392c0552f"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-af532d8dc5ea4fb195e3f4f392c0552f") {
      outputDiv = document.getElementById("altair-viz-af532d8dc5ea4fb195e3f4f392c0552f");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.9}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



### 2.2 이중-축 차트

- 시애틀은 비오는 도시라는 평판을 가지고 있다. 실제로 그럴까?
- 이번에는 강수량을 살펴보자. 먼저 시애틀의 월 평균 강수량을 시각화하자. 


```python
alt.Chart(weather).transform_filter(                      # 시애틀만 필터링
  'datum.location == "Seattle"'
).mark_line(
  interpolate='monotone',                                 # 보간법 옵션
  stroke='grey'                                           # 선 색상 
).encode(
  alt.X('month(date):T', title=None),
  alt.Y('average(precipitation):Q', title='평균 강수량')  
)
```





<div id="altair-viz-0647d8fdef864545b360c701892de7d9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0647d8fdef864545b360c701892de7d9") {
      outputDiv = document.getElementById("altair-viz-0647d8fdef864545b360c701892de7d9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "\ud3c9\uade0 \uac15\uc218\ub7c9", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 기온 데이터와 쉽게 비교할 수 있도록, 강수량 차트를 새로운 층으로 추가하자.   
  기온 차트와 강수량 차트를 층으로 단순하게 겹치면 아래처럼 된다.  


```python
tempMinMax = alt.Chart(weather).transform_filter(                  # 기온 차트
  'datum.location == "Seattle"'
).mark_area(opacity=0.3).encode(
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),
  alt.Y('average(temp_max):Q', title='평균 기온 °C'),
  alt.Y2('average(temp_min):Q')
)

precip = alt.Chart(weather).transform_filter(                      # 강수량 차트
  'datum.location == "Seattle"'
).mark_line(
  interpolate='monotone',
  stroke='grey'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(precipitation):Q', title='평균 강수량')
)

alt.layer(tempMinMax, precip)                                      # 다층 결합
```





<div id="altair-viz-a1ef42b74c6e4c0dacffae8c43b3f5a5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a1ef42b74c6e4c0dacffae8c43b3f5a5") {
      outputDiv = document.getElementById("altair-viz-a1ef42b74c6e4c0dacffae8c43b3f5a5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}, {"mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "\ud3c9\uade0 \uac15\uc218\ub7c9", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 강수량 값은 y-축의 아래 영역에만 그려진다. 
- 기본적으로, 겹쳐진 다층 차트는 **공유 도메인(shared domain)** 방식을 사용한다.  
  - 단일 범위를 공유할 수 있도록,  
    x-축과 y-축의 데이터 값들은 모든 층에 대하여 결합된다.  
  - 이러한 기본적 처리 방식에서 층별 데이터 값은 **공통 단위**로 간주된다. 
  - 이 예제에서 이러한 기본적 처리 방식은 적절하지 않다.  
    기온은 섭씨 단위로, 강수량은 인치 단위로 측정되었다. 
- y-축 단위가 데이터 층마다 다르므로,  
  데이터 층마다 차별적인 축 처리 방법이 필요하다.  
  - 이 경우에 y-축 `scale` 도메인은 공유 `shared` 도메인이 아니라  
    독립적 `independent`인 도메인으로 처리되어야 한다. 
  - 층 연산자에 의하여 다층으로 겹쳐지는  
    `Chart` 객체는 `resolve_scale` 메소드를 제공하는데, 이를 활용해야 한다. 


```python
alt.layer(tempMinMax, precip).resolve_scale(y='independent')  # 다층 결합, 독립적인 이중 축       
```





<div id="altair-viz-2a31bafb4df143b7b6b3cbf39d0b11d1"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-2a31bafb4df143b7b6b3cbf39d0b11d1") {
      outputDiv = document.getElementById("altair-viz-2a31bafb4df143b7b6b3cbf39d0b11d1");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "\ud3c9\uade0 \uae30\uc628 \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}, {"mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "\ud3c9\uade0 \uac15\uc218\ub7c9", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "resolve": {"scale": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 시애틀의 가을은 비가 많은 시기이고 11월이 피크인데, 여름은 건조하다는 것을 알게 되었다. 
- 위 시각화 코드에는 약간의 중복성이 존재한다. 
  - 기온 시각화나 강수량 시각화에서 동일한 데이터 세트와 필터를 사용하고 있다. 
  - 원한다면 코드에서 데이터와 필터 변환을 최상위 층 차트에 제공하여 중복을 제거할 수 있다. 
  - 개별 층에서 (해당 층에서만 사용하는 별도 데이터가 없다면) 이 데이터를 상속받아 처리할 수 있다. 


```python
tempMinMax = alt.Chart().mark_area(opacity=0.3).encode(            # 데이터 지정 생략
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),
  alt.Y('average(temp_max):Q', title='Avg. Temperature °C'),
  alt.Y2('average(temp_min):Q')
)

precip = alt.Chart().mark_line(                                    # 데이터 지정 생략
  interpolate='monotone',
  stroke='grey'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(precipitation):Q', title='Precipitation')
)

alt.layer(tempMinMax, precip, data=weather).transform_filter(      # layer()에서 데이터 지정 및 필터링
  'datum.location == "Seattle"'
).resolve_scale(y='independent')
```





<div id="altair-viz-fc0e9f98e9934c579da506156a324065"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-fc0e9f98e9934c579da506156a324065") {
      outputDiv = document.getElementById("altair-viz-fc0e9f98e9934c579da506156a324065");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature \u00b0C", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": {"type": "line", "interpolate": "monotone", "stroke": "grey"}, "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "title": "Precipitation", "type": "quantitative"}}}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "resolve": {"scale": {"y": "independent"}}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 이중-축(dual-axis) 차트가 유용하긴 하지만,  
  상이한 단위와 축 스케일이 어울리지 못하고 잘못 해석되는 경향이 있다.  
  - 상이한 데이터 필드들이 공통된 단위를 가지도록 변환하는 방법도 생각해 볼 수 있다.  
  - 예를 들어서 [분위수](https://bioinformaticsandme.tistory.com/246) 또는 상대적 백분율로 변경하여 시각화 할 수도 있다. 

## 3. 다면 구성

- **다면 구성**(**faceting**)은 데이터 세트를 분할하여 그룹으로 구성하고,  
  각 그룹별로 개별적인 플롯을 작성하는 방법이다. 
  - 지난 2 장에서 `row` 및 `column` 인코딩 채널을 사용한 다면 구성 차트 작성법을 공부한 바 있다. 
  - 먼저 이들 채널을 검토하고,  
    이들이 어떻게 더욱 일반적인 `facet` 연산자의 사례가 될 수 있는지를 설명한다.  
- 시애틀 데이터에서 최고 기온에 관한 기본적인 도수분포도(histogram)로 시작해보자. 


```python
alt.Chart(weather).mark_bar().transform_filter(
  'datum.location == "Seattle"'
).encode(
  alt.X('temp_max:Q', bin=True, title='Temperature (°C)'),
  alt.Y('count():Q')
)
```





<div id="altair-viz-568453fb4c12415fa9e36b76e750ff3a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-568453fb4c12415fa9e36b76e750ff3a") {
      outputDiv = document.getElementById("altair-viz-568453fb4c12415fa9e36b76e750ff3a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "bar", "encoding": {"x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- (이슬비, 안개, 비, 눈, 해)로 구분된 날씨 `weather` 필드 값에 따라서 기온 프로필을 어떻게 변경할 수 있을까?  
  - `column` 인코딩 채널을 사용해서, 데이터를 날씨 유형에 따라서 다면적으로 구성(facet)할 수 있다.  
  - 또한 `color`를 중복된 인코딩으로 사용하는데, 맞춤형 색상 범위를 지정한다.  


```python
colors = alt.Scale(
  domain=['drizzle', 'fog', 'rain', 'snow', 'sun'],              # (이슬비, 안개, 비, 눈, 해) 색상 도메인 
  range=['#aec7e8', '#c7c7c7', '#1f77b4', '#9467bd', '#e7ba52']  # 색상 범위
)

facet = alt.Chart(weather).mark_bar().transform_filter(
  'datum.location == "Seattle"'
).encode(
  alt.X('temp_max:Q', bin=True, title='일별 최고 기온 (°C)'),
  alt.Y('count():Q'),
  alt.Color('weather:N', scale=colors),                          # 색상 인코딩 채널
  alt.Column('weather:N')                                        # 다면 구성 인코딩 채널
).properties(
  width=150,
  height=150
)
facet
```





<div id="altair-viz-0b670c55f50941b08ea928418bde2cb9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0b670c55f50941b08ea928418bde2cb9") {
      outputDiv = document.getElementById("altair-viz-0b670c55f50941b08ea928418bde2cb9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "bar", "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "column": {"field": "weather", "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "\uc77c\ubcc4 \ucd5c\uace0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 150, "transform": [{"filter": "datum.location == \"Seattle\""}], "width": 150, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>




```python
facet
```





<div id="altair-viz-537e0dac83534276a676b3e8b4722acc"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-537e0dac83534276a676b3e8b4722acc") {
      outputDiv = document.getElementById("altair-viz-537e0dac83534276a676b3e8b4722acc");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "bar", "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "column": {"field": "weather", "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "\uc77c\ubcc4 \ucd5c\uace0 \uae30\uc628 (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 150, "transform": [{"filter": "datum.location == \"Seattle\""}], "width": 150, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 눈 내리는 날은 매우 드믄 편인데, 가장 추운 날씨에만 집중되어 있다.  
- 비가 오거나 안개가 끼는 날은 기온이 다소 낮은 수준이다.  
- 해가 나는 날은 따듯한 날인 경우가 많다. 시애틀의 고정관념과는 달리 해가 나는 날이 꽤나 많다.  
- 이슬비는 기온에 상관없이, 가끔 내리는 것 같다.

- `row` 및 `column` 인코딩 채널을 쓰지 않고도, 다면 구성을 처리할 수 있다.  
  차트 정의는 기본적으로 처리하되,  
  명시적인 `facet()` 메소드에서 `column` 인자를 통해서 다면 구성이 가능하다. 
- 앞서 작성한 차트를 다시 만들어 보는데, 이번에는 `facet()` 메소드를 써 보자. 
  - 동일한 기본적인 도수분포도(histogram) 정의로 시작하는데,  
    데이터 원천, 필터 변환 및 `column` 채널은 지정하지 않는다. 
  - 이어서 `facet()` 메소드를 호출하는데,  
    `data=weather`와 `column='weather:N'`으로 인수를 지정한다.  
    - 'weather:N' 값에 따라서 열별로 다면을 구성한다. 
    - 행별로 구성하려면 `row` 인수를 쓴다. 
    - `column`과 `row` 인수를 동시에 지정하면, 이차원 그리드 형태로 다면 구성이 가능하다. 
- 마지막으로 필터 변환을 추가하여, 다면 구성된 최상위 수준의 차트에 적용한다.  
  - 필터 변환을 앞 부분에서 막대그래프를 정의할 때 처리할 수도 있었는데,  
    이렇게 하면 다소 비효율적이다. 
  - 이렇게 하면 구성된 각각의 다면 셀마다 매번 필터링을 처리하게 된다.  
  - 다면 구성이 완성된 차트에 대해서 필터링을 지정하면,  
    베가-라이트가 다면 분할 작업을 수행하기 이전에 처음부터 필터링을 처리해 준다. 


```python
colors = alt.Scale(
  domain=['drizzle', 'fog', 'rain', 'snow', 'sun'],
  range=['#aec7e8', '#c7c7c7', '#1f77b4', '#9467bd', '#e7ba52']
)

alt.Chart().mark_bar().encode(                              # 데이터 원천, 필터 변환, column 채널 지정 생략
  alt.X('temp_max:Q', bin=True, title='Temperature (°C)'),
  alt.Y('count():Q'),
  alt.Color('weather:N', scale=colors)
).properties(
  width=150,
  height=150
).facet(                                                    # facet() 메소드에서 data와 column 인수 지정
  data=weather,
  column='weather:N'
).transform_filter(                                         # 필터 변환을 마지막에 처리 
  'datum.location == "Seattle"'
)
```





<div id="altair-viz-7b2bce609daa4ffd8916ec9a7c71ff24"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7b2bce609daa4ffd8916ec9a7c71ff24") {
      outputDiv = document.getElementById("altair-viz-7b2bce609daa4ffd8916ec9a7c71ff24");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "facet": {"column": {"field": "weather", "type": "nominal"}}, "spec": {"mark": "bar", "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 150, "width": 150}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 명시적으로 `facet()` 메소드를 호출하려는 이유는 무엇일까?  
  - 기본적인 차트라면, `column` 및 `row` 인코딩 채널을 쓰는 편이 훨씬 간편하다. 
  - 겹쳐진 다층 차트 같은 뷰를 다면 구성하려는 경우라면,  
    `facet()` 메소드를 명시적으로 호출하는 편이 더 유리하다. 
- 앞서 작성했던 최소/최대 기온과 중간 기온을 겹쳐서 만들었던 다층 차트에 대해 다시 생각해 보자.
  - 뉴욕과 시애틀을 단일 차트로 시각화하는 대신에, 분리된 다면 차트로 구성할 수 있다. 
  - 개별적인 차트 정의는 앞선 경우와 거의 유사하게,  
    최소/최대 기온 면적 차트와 중간 기온 꺽은선 차트를 겹쳐서 작성할 것이다. 
  - 달라져야 할 점은 차트 생성자에게 데이터를 직접 전달하지 말아야 한다는 것이다.
  - `facet()` 연산자 호출 단계에서 데이터를 전달해야 한다.
  - 앞서와 같은 방법으로 차트를 다층으로 겹치고,  
    겹쳐진 차트 객체에 대하여 `facet()` 메소드를 호출하면서  
    `column='location:N'`으로 인수를 지정하여 다면 구성을 처리한다.  


```python
tempMinMax = alt.Chart().mark_area(opacity=0.3).encode(            # 최소/최대 기온 면적 차트 정의(데이터 전달 생략)
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),
  alt.Y('average(temp_max):Q', title='Avg. Temperature (°C)'),
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart().mark_line().transform_calculate(             # 중간 기온 꺽은선 차트 정의(데이터 전달 생략)
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),
  alt.Color('location:N')
)

alt.layer(tempMinMax, tempMid).facet(                              # 다층 구성 및 다면 구성
  data=weather,
  column='location:N'
)
```





<div id="altair-viz-b1d7eff22d184733a79313138c2393d5"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-b1d7eff22d184733a79313138c2393d5") {
      outputDiv = document.getElementById("altair-viz-b1d7eff22d184733a79313138c2393d5");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 지금까지 공부한 다면 구성 차트는 모든 다면 셀에 대하여 동일한 축 스케일 도메인을 사용했다.
  - 기본값에 의하여 **공용** 스케일과 축을 사용하는 것이 값의 정확한 비교에 도움이 되었다. 
  - 하지만 어떤 경우에는 각 차트마다 독립적인 스케일과 축을 원할 수도 있다.  
    특히 다면 셀마다 값의 범위가 많이 다른 경우에는 그럴 수 있다. 
- 다층으로 겹쳐진 차트와 유사하게, 다면 구성 차트에서도 차트마다 독립적인 스케일이나 축을 쓸 수 있다.  
  `resolve_axis()` 메소드에서 독립적인 `independent` y-축을 요청하면 어떻게 될까? 


```python
tempMinMax = alt.Chart().mark_area(opacity=0.3).encode(
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),
  alt.Y('average(temp_max):Q', title='Avg. Temperature (°C)'),
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart().mark_line().transform_calculate(
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),
  alt.Color('location:N')
)

alt.layer(tempMinMax, tempMid).facet(
  data=weather,
  column='location:N'
).resolve_axis(y='independent')                                      # 독립적 y-축                               
```





<div id="altair-viz-7544175a41e245f5a709f2f14efb1b0b"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-7544175a41e245f5a709f2f14efb1b0b") {
      outputDiv = document.getElementById("altair-viz-7544175a41e245f5a709f2f14efb1b0b");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "resolve": {"axis": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 위 차트는 이전 차트와 비슷해보이지만, `resolve_axis()` 호출로 인하여 시애틀 차트에 독자적인 축을 가진다. 

- 스케일 도메인을 독립적으로 처리하기 위하여, `resolve_scale()` 메소드를 사용하면 어떻게 될까?


```python
tempMinMax = alt.Chart().mark_area(opacity=0.3).encode(
  alt.X('month(date):T', title=None, axis=alt.Axis(format='%b')),
  alt.Y('average(temp_max):Q', title='Avg. Temperature (°C)'),
  alt.Y2('average(temp_min):Q'),
  alt.Color('location:N')
)

tempMid = alt.Chart().mark_line().transform_calculate(
  temp_mid='(+datum.temp_min + +datum.temp_max) / 2'
).encode(
  alt.X('month(date):T'),
  alt.Y('average(temp_mid):Q'),
  alt.Color('location:N')
)

bc = alt.layer(tempMinMax, tempMid).facet(
  data=weather,
  column='location:N'
).resolve_scale(y='independent')                                      # 독립적 스케일

bc
```





<div id="altair-viz-3d8341ca7be542e4a1d8c45906864cfc"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-3d8341ca7be542e4a1d8c45906864cfc") {
      outputDiv = document.getElementById("altair-viz-3d8341ca7be542e4a1d8c45906864cfc");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "resolve": {"scale": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>




```python
bc
```





<div id="altair-viz-0230b1e3b1b04660af5fc26ec5ce6118"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-0230b1e3b1b04660af5fc26ec5ce6118") {
      outputDiv = document.getElementById("altair-viz-0230b1e3b1b04660af5fc26ec5ce6118");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "facet": {"column": {"field": "location", "type": "nominal"}}, "spec": {"layer": [{"mark": {"type": "area", "opacity": 0.3}, "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"axis": {"format": "%b"}, "field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "title": "Avg. Temperature (\u00b0C)", "type": "quantitative"}, "y2": {"aggregate": "average", "field": "temp_min"}}}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_mid", "type": "quantitative"}}, "transform": [{"calculate": "(+datum.temp_min + +datum.temp_max) / 2", "as": "temp_mid"}]}]}, "resolve": {"scale": {"y": "independent"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 두 차트가 서로 다른 축 스케일 도메인으로 시각화 되었다. 
  - 이 경우에 독립적 스케일을 쓰는 것이 적절하지는 않아 보인다. 
  - 두 도메인이 크게 다르지는 않다.  
    오히려 독립적 스케일로 인하여 뉴욕과 시애틀의 온도 차이가 얼마 되지 않는다고 착각하기 쉽다. 
- 할 수 있다고, 모두 해도 되는 것은 아니다!

## 4. 병합

- 다면 구성은 데이터를 분할하여 다수의 작은 [small multiple](https://en.wikipedia.org/wiki/Small_multiple) 플롯을 만들어 낸다. 
- 하지만 다른 관점에서 다중 뷰 시각화를 만들고 싶을 수 있다. 
  - **같은** 데이터 세트의 상이한 뷰로 다중 뷰 시각화
  - **다른** 데이터 세트에 관련된 뷰로 다중 뷰 시각화
- **병합**(**concatenation**) 연산자를 써서 임의의 차트들을 단일 차트로 구성할 수 있다.  
  - `hconcat()` 메소드 또는 `|` 연산자로 수평 병합
  - `vconcat()` 메소드 또는 `&` 연산자로 수직 병합

- 뉴욕과 시애틀에 대하여 일별 최고 기온의 월별 평균치를 보여주는 기본적인 꺽은선 차트에서 시작하자. 


```python
alt.Chart(weather).mark_line().encode(
  alt.X('month(date):T', title=None),
  alt.Y('average(temp_max):Q'),
  color='location:N'
)
```





<div id="altair-viz-c060892ba4ec4e91953dd1d130af3d55"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c060892ba4ec4e91953dd1d130af3d55") {
      outputDiv = document.getElementById("altair-viz-c060892ba4ec4e91953dd1d130af3d55");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 시간에 따른 기온의 비교와 함께, 강수량과 풍속에 대해서도 두 도시를 비교하고 싶다고 가정하자. 
  - (기온, 강수량, 풍속에 관한) 3개 플롯으로 구성된 병합 차트를 만들려고 한다. 
  - "기본(base)" 차트 정의 작성부터 시작해야 하는데, 기본 차트에는 3개 플롯에서 공용으로 사용할 내용을 정의한다. 
  - 이어서 정의된 기본 차트를 수정해서,   
    세 필드 `temp_max`, `precipitation` 및 `wind`에 대한 개별적인 y-축 인코딩을 지정한다. 
  - 마지막으로 3개 플롯을 병합한다. 


```python
base = alt.Chart(weather).mark_line().encode(            # 기본 차트에 공통적인 내용을 정의
  alt.X('month(date):T', title=None),
  color='location:N'
).properties(
  width=240,
  height=180
)

temp = base.encode(alt.Y('average(temp_max):Q'))         # 기본 차트에 y-축 인코딩 지정
precip = base.encode(alt.Y('average(precipitation):Q'))  # 기본 차트에 y-축 인코딩 지정
wind = base.encode(alt.Y('average(wind):Q'))             # 기본 차트에 y-축 인코딩 지정

temp | precip | wind                                     # 병합
```





<div id="altair-viz-c3505a253d6c4cc09fdf5ed7a36076a2"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c3505a253d6c4cc09fdf5ed7a36076a2") {
      outputDiv = document.getElementById("altair-viz-c3505a253d6c4cc09fdf5ed7a36076a2");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "wind", "type": "quantitative"}}, "height": 180, "width": 240}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 파이프 `|` 연산자대신에, 더욱 명시적인 `alt.hconcat()` 메소드를 사용할 수 있다. 


```python
alt.hconcat(temp, precip, wind)
```





<div id="altair-viz-a05d9caf488e47908787627cb491a7c2"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a05d9caf488e47908787627cb491a7c2") {
      outputDiv = document.getElementById("altair-viz-a05d9caf488e47908787627cb491a7c2");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "wind", "type": "quantitative"}}, "height": 180, "width": 240}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 수직 병합도 수평 병합과 유사하다. `&` 연산자 또는 `alt.vconcat` 메소드를 사용할 수 있다.


```python
temp & precip & wind
```





<div id="altair-viz-5dcbae2c4ded4db6b7102bcd93b1f5b9"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-5dcbae2c4ded4db6b7102bcd93b1f5b9") {
      outputDiv = document.getElementById("altair-viz-5dcbae2c4ded4db6b7102bcd93b1f5b9");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "wind", "type": "quantitative"}}, "height": 180, "width": 240}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 마지막으로, 수평 및 수직 병합을 결합할 수 있다. 


```python
(temp | precip) & wind
```





<div id="altair-viz-65906fcc8c8b4b6ca29bce93a29037b4"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-65906fcc8c8b4b6ca29bce93a29037b4") {
      outputDiv = document.getElementById("altair-viz-65906fcc8c8b4b6ca29bce93a29037b4");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "vconcat": [{"hconcat": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "type": "quantitative"}}, "height": 180, "width": 240}]}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "wind", "type": "quantitative"}}, "height": 180, "width": 240}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 괄호의 중요성을 명심하라. 직전 코드에서 괄호를 제거하면 어떻게 되는가?  
  - 이들 연산자는 원래의 기능을 상속받아서 재정의(overload)되었는데,  
    여전히 [파이썬 연산자 우선순위](https://dojang.io/mod/page/view.php?id=2461) 규칙을 적용받는다. 
  - 따라서 수직 병합 `&` 연산이 수평 병합 `|` 연산보다 우선순위가 높다. 
- 나중에 다시 설명할 예정이지만, 병합 기능을 활용하면 어떤 차트이든지 가리지 않고,   
  모든 차트를 하나의 다중-뷰 대시보드(dashboard)로 구성할 수 있다. 


```python
temp | precip & wind
```





<div id="altair-viz-308145fa7440414e879bf2ea0e87fb32"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-308145fa7440414e879bf2ea0e87fb32") {
      outputDiv = document.getElementById("altair-viz-308145fa7440414e879bf2ea0e87fb32");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "height": 180, "width": 240}, {"vconcat": [{"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "precipitation", "type": "quantitative"}}, "height": 180, "width": 240}, {"mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": "wind", "type": "quantitative"}}, "height": 180, "width": 240}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



## 5. 반복

- 병합 작업은 상당히 일반적이므로, 어떠한 차트라도 구성할 수 있다.  
  - 그럼에도 불구하고, 앞선 예제는 다소 복잡하다. 
  - 유사한 3개 차트를 개별적으로 정의한 후, 병합했다. 
- 단지 변수 한개 혹은 두개가 바뀌는 경우라면, 반복 `repeat` 연산자를 써서 다중 차트를 쉽게 만들 수 있다.   
  일부 자유 변수를 가지는 **템플릿**(**template**) 명세를 지정하면,  
  반복 연산자가 이 자유 변수에 대한 반복적 대입을 통하여 차트를 만들어 낸다.  
- 앞선 병합 예제를 `repeat` 연산자로 처리해 보자.  
  - 차트마다 달라져야 하는 부분은 `y` 인코딩 채널에 대한 데이터 필드의 선택일 뿐이다. 
  - 템플릿 명세를 작성하기 위하여,  
    **반복자 변수**(**repeater variable**) `alt.repeat('column')`를 y-축 필드로 사용할 수 있다. 
  - 이 반복자 변수에 대한 코드는, `column` 반복자에 대입되는 변수를 사용할 것이라는 표현이다.  
    - 이렇게 지정하여 반복적인 차트를 열 방향으로 구성한다. 
    - 반복자는 단지 필드 이름만 제공하기 때문에, 필드 데이터 유형을 별도로 `type='quantitative'`라고 명시한다. 
  - 최종적으로 `repeat()` 메소드를 호출하면서, 각 column에 대한 데이터 필드 이름을 전달한다. 


```python
alt.Chart(weather).mark_line().encode(
  alt.X('month(date):T', title=None),
  alt.Y(
    alt.repeat('column'),                    # 변수에 대한 템플릿 명세, 반복자 변수 column을 지정,   
    aggregate='average', 
    type='quantitative'),                    # 필드 유형 별도 지정
  color='location:N'
).properties(
  width=240,
  height=180
).repeat(                                        # 변수 column에 대하여 반복할 데이터 필드 지정
  column=['temp_max', 'precipitation', 'wind']
)
```





<div id="altair-viz-fd54f834c71242cb8ee8dea925e3ca4b"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-fd54f834c71242cb8ee8dea925e3ca4b") {
      outputDiv = document.getElementById("altair-viz-fd54f834c71242cb8ee8dea925e3ca4b");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["temp_max", "precipitation", "wind"]}, "spec": {"data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}, "height": 180, "width": 240}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 반복은 `row`에 대해서도 (행 방향으로) 처리 가능하다. 


```python
alt.Chart(weather).mark_line().encode(
  alt.X('month(date):T', title=None),
  alt.Y(
    alt.repeat('row'),                       # 변수에 대한 템플릿 명세, 반복자 변수 row를 지정 
    aggregate='average', 
    type='quantitative'),                    # 필드 유형 별도 지정
  color='location:N'
).properties(
  width=240,
  height=180
).repeat(                                    # 변수 row에 대하여 반복할 데이터 필드 지정
  row=['temp_max', 'precipitation', 'wind']
)
```





<div id="altair-viz-a2d8303d18234baca42471c24136322c"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-a2d8303d18234baca42471c24136322c") {
      outputDiv = document.getElementById("altair-viz-a2d8303d18234baca42471c24136322c");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"row": ["temp_max", "precipitation", "wind"]}, "spec": {"data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "mark": "line", "encoding": {"color": {"field": "location", "type": "nominal"}, "x": {"field": "date", "timeUnit": "month", "title": null, "type": "temporal"}, "y": {"aggregate": "average", "field": {"repeat": "row"}, "type": "quantitative"}}, "height": 180, "width": 240}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- `row` 및 `column` 반복을 함께 사용할 수 있다.  
  - 탐색적 데이터 분석(exploratory data analysis)을 위한 시각화에서  
    산점도 행렬([scatter plot matrix (or SPLOM)](https://en.wikipedia.org/wiki/Scatter_plot#Scatterplot_matrices))은 자주 사용된다. 
  - 검토할 변수 컬렉션이 주어진 상황에서,  
    SPLOM은 이들 변수들의 모든 순서쌍에 대한 플롯을 그리드 형태로 제공함으로써,  
    숨겨진 상관성을 찾아내도록 도와준다. 
- `repeat` 메소드를 써서 `temp_max`, `precipitation` 및 `wind` 필드에 대한 SPLOM을 시각화해 보자. 
  - 먼저 템플릿 명세를 만드는데, x-축 및 y-축 데이터 필드 모두에 대한 반복자 변수를 지정해야 한다. 
  - `repeat` 메소드를 호출하면서 `row`와 `column`으로 사용할 필드 이름의 배열을 전달한다. 
  - 이렇게 하면,  
    알테어가 크로스 곱 또는 카티션 곱 [cross product (or, Cartesian product)](https://en.wikipedia.org/wiki/Cartesian_product)을 생성하여 반복되는 차트 행렬을 시각화한다. 


```python
SPLOM = alt.Chart().mark_point(filled=True, size=15, opacity=0.5).encode(
  alt.X(alt.repeat('column'), type='quantitative'),                # x-축 반복자 필드 column 지정
  alt.Y(alt.repeat('row'), type='quantitative')                    # y-축 반복자 필드 row 지정
).properties(
  width=150,
  height=150
).repeat(                                           
  data=weather,
  row=['temp_max', 'precipitation', 'wind'],                       # row 반복 필드의 배열
  column=['wind', 'precipitation', 'temp_max']                     # column 반복 필드의 배열
).transform_filter(
  'datum.location == "Seattle"'
)

SPLOM
```





<div id="altair-viz-cdc4bf900073448382dca47c22463988"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-cdc4bf900073448382dca47c22463988") {
      outputDiv = document.getElementById("altair-viz-cdc4bf900073448382dca47c22463988");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["wind", "precipitation", "temp_max"], "row": ["temp_max", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 150, "width": 150}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 강수량(precipitation)과 바람(wind) 간의 강한 상관성은 확인하기 어렵다.  
  하지만 강풍과 폭우가 비슷한 기온 범위 (5-15° C)에서 발생한다.  
  그렇지만 이러한 관찰이 특별히 놀라울 것도 없다.  
  다면 구성에 관한 시작 부분에서 작성했던 기온에 관한 막대그래프를 보면, 최고 기온이 5-15° C 범위에 있는 날이 매우 일상적이다. 


```python
SPLOM
```





<div id="altair-viz-c422ea3d777d417994215ff79169e8e6"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-c422ea3d777d417994215ff79169e8e6") {
      outputDiv = document.getElementById("altair-viz-c422ea3d777d417994215ff79169e8e6");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["wind", "precipitation", "temp_max"], "row": ["temp_max", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 150, "width": 150}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 차트 반복을 더 잘 이해하기 위해서 위 코드를 수정하자.  
  - SPLOM에 변수 `temp_min`를 추가해 보자. 
  - `repeat` 메소드에 대한 `row` 또는 `column` 인자의 필드이름 순서를 조정해 보자. 

## 1) `row`와 `column`의 변수 순서가 동일한 코드


```python
SPLOM = alt.Chart().mark_point(filled=True, size=15, opacity=0.5).encode(
  alt.X(alt.repeat('column'), type='quantitative'),                # x-축 반복자 필드 column 지정
  alt.Y(alt.repeat('row'), type='quantitative')                    # y-축 반복자 필드 row 지정
).properties(
  width=150,
  height=150
).repeat(                                           
  data=weather,
  row=['temp_max', 'temp_min', 'precipitation', 'wind'],           # row 반복 필드의 배열
  column=['temp_max', 'temp_min', 'precipitation', 'wind']         # column 반복 필드의 배열
).transform_filter(
  'datum.location == "Seattle"'
)

SPLOM
```





<div id="altair-viz-d8ffd87363444015807f557dd899d984"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d8ffd87363444015807f557dd899d984") {
      outputDiv = document.getElementById("altair-viz-d8ffd87363444015807f557dd899d984");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["temp_max", "temp_min", "precipitation", "wind"], "row": ["temp_max", "temp_min", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 150, "width": 150}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



## 2) `row`와 `column`의 변수 순서가 반대인 코드


```python
SPLOM = alt.Chart().mark_point(filled=True, size=15, opacity=0.5).encode(
  alt.X(alt.repeat('column'), type='quantitative'),                # x-축 반복자 필드 column 지정
  alt.Y(alt.repeat('row'), type='quantitative')                    # y-축 반복자 필드 row 지정
).properties(
  width=150,
  height=150
).repeat(                                           
  data=weather,
  row=['temp_max', 'temp_min', 'precipitation', 'wind'],           # row 반복 필드의 배열
  column=['wind', 'precipitation', 'temp_min', 'temp_max']         # column 반복 필드의 배열
).transform_filter(
  'datum.location == "Seattle"'
)

SPLOM
```





<div id="altair-viz-23d0bf4cd8bf478e9165edbb406f602a"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-23d0bf4cd8bf478e9165edbb406f602a") {
      outputDiv = document.getElementById("altair-viz-23d0bf4cd8bf478e9165edbb406f602a");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["wind", "precipitation", "temp_min", "temp_max"], "row": ["temp_max", "temp_min", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 150, "width": 150}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 최소 기온과 최대 기온 간의 강력한 상관성을 확인할 수 있다. 


```python
SPLOM
```





<div id="altair-viz-f3e000cdd0f34f8ea92df0e3d23434ac"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-f3e000cdd0f34f8ea92df0e3d23434ac") {
      outputDiv = document.getElementById("altair-viz-f3e000cdd0f34f8ea92df0e3d23434ac");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["wind", "precipitation", "temp_min", "temp_max"], "row": ["temp_max", "temp_min", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 150, "width": 150}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 마지막으로, `repeat` 메소드의 기능을 제대로 이해하기 위하여,  
  단지 `hconcat`과 `vconcat`만으로 SPLOM을 시각화하려면 어떻게 해야 하는지를 고민해 보라. 

## 6. 뷰 구성 연산자

- 구성 메소드 `layer`, `facet`, `concat` 및 `repeat`를 조합하면 다양한 다중 뷰 시각화가 가능하다. 
- 예를 들기 위하여, 기본적 차트 두 개로 시작하자: 
  - 최고 기온의 평균값을 월별로 보여주는 막대그래프 
  - 단일 `rule` 마크로 최고 기온의 전체 평균을 보여주는 단순 꺽은선 차트


```python
basic1 = alt.Chart(weather).transform_filter(  
  'datum.location == "Seattle"'
).mark_bar().encode(                           # 막대그래프
  alt.X('month(date):O'),
  alt.Y('average(temp_max):Q')
)

basic2 = alt.Chart(weather).transform_filter(
  'datum.location == "Seattle"'
).mark_rule(stroke='firebrick').encode(        # 꺽은선 차트  
  alt.Y('average(temp_max):Q')
)

basic1 | basic2
```





<div id="altair-viz-b5b2d1bc3e944ac2886f4df63af2a5fe"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-b5b2d1bc3e944ac2886f4df63af2a5fe") {
      outputDiv = document.getElementById("altair-viz-b5b2d1bc3e944ac2886f4df63af2a5fe");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "hconcat": [{"mark": "bar", "encoding": {"x": {"field": "date", "timeUnit": "month", "type": "ordinal"}, "y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": "temp_max", "type": "quantitative"}}, "transform": [{"filter": "datum.location == \"Seattle\""}]}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 두 차트의 y 축 눈금 범위가 달라서 직접 비교가 곤란함
- 이제 이 두 차트를 `layer` 메소드로 결합하고,  
  막대그래프 위에 전체 평균 기온 라인을 겹처서 표시한 차트를  
  `['temp_max', 'precipitation', 'wind']`에 대하여 `repeat` 메소드로 다면 구성하자.  


```python
faces = alt.layer(                                                             # 다층으로 겹친 기본 템플릿
  alt.Chart().mark_bar().encode(
    alt.X('month(date):O', title='Month'),
    alt.Y(alt.repeat('column'), aggregate='average', type='quantitative')),    # column 필드의 월별 평균 막대
  alt.Chart().mark_rule(stroke='firebrick').encode(
    alt.Y(alt.repeat('column'), aggregate='average', type='quantitative'))     # column 필드의 전체 평균 수평선
).properties(                
  width=200,
  height=150
).repeat(                                                                      # 반복   
  data=weather,
  column=['temp_max', 'precipitation', 'wind']                                 # column에 반복될 필드
).transform_filter(
  'datum.location == "Seattle"'
)
faces 
```





<div id="altair-viz-970a1b4771624d5fabdbc2ba5bc0d373"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-970a1b4771624d5fabdbc2ba5bc0d373") {
      outputDiv = document.getElementById("altair-viz-970a1b4771624d5fabdbc2ba5bc0d373");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["temp_max", "precipitation", "wind"]}, "spec": {"layer": [{"mark": "bar", "encoding": {"x": {"field": "date", "timeUnit": "month", "title": "Month", "type": "ordinal"}, "y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}}], "height": 150, "width": 200}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 다중-뷰 구성 메소드에만 집중하자면, 앞의 시각화를 위한 모델은 다음과 같다. 

```
repeat(column=[...])
|- layer
   |- basic1
   |- basic2
```


```python
faces 
```





<div id="altair-viz-d135ea92740546edabca2a0def9a00a7"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-d135ea92740546edabca2a0def9a00a7") {
      outputDiv = document.getElementById("altair-viz-d135ea92740546edabca2a0def9a00a7");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "repeat": {"column": ["temp_max", "precipitation", "wind"]}, "spec": {"layer": [{"mark": "bar", "encoding": {"x": {"field": "date", "timeUnit": "month", "title": "Month", "type": "ordinal"}, "y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": {"repeat": "column"}, "type": "quantitative"}}}], "height": 150, "width": 200}, "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 이제 시애틀 날씨를 개괄하는 최종적인 대시보드 [dashboard](https://en.wikipedia.org/wiki/Dashboard_%28business%29) 내부에서  
  이 모든 메소드를 어떻게 적용해야 하는지 궁리해 보자.  
- 세 종류 차트를 종합하는 대시보드를 만들자. 
  - 앞에서 작성했던 SPLOM (3x3 종)
  - 직전에 작성한 다면 구성 겹침 차트 3 종
  - 다면 구성에서 작성했던 기온 차트 5 종


```python
splom = alt.Chart().mark_point(filled=True, size=15, opacity=0.5).encode(  # SPLOM 3x3 종
  alt.X(alt.repeat('column'), type='quantitative'),
  alt.Y(alt.repeat('row'), type='quantitative')
).properties(
  width=125, height=125
).repeat(
  row=['temp_max', 'precipitation', 'wind'],
  column=['wind', 'precipitation', 'temp_max']
)

layeredHist = alt.layer(                                                      # 겹침 차트 3 종
  alt.Chart().mark_bar().encode(
    alt.X('month(date):O', title='Month'),
    alt.Y(alt.repeat('row'), aggregate='average', type='quantitative')),
  alt.Chart().mark_rule(stroke='firebrick').encode(
    alt.Y(alt.repeat('row'), aggregate='average', type='quantitative'))
).properties(
  width=175, height=125
).repeat(
  row=['temp_max', 'precipitation', 'wind']
)

tempHist = alt.Chart(weather).mark_bar().encode(                              # 기온 차트 5 종
  alt.X('temp_max:Q', bin=True, title='Temperature (°C)'),
  alt.Y('count():Q'),
  alt.Color(
    'weather:N', 
    scale=alt.Scale(
      domain=['drizzle', 'fog', 'rain', 'snow', 'sun'],
      range=['#aec7e8', '#c7c7c7', '#1f77b4', '#9467bd', '#e7ba52']))
).properties(
  width=115, height=100
).facet(
  column='weather:N'
)

alt.vconcat(
  alt.hconcat(splom, layeredHist),    # (SPLOM | layeredHist)
  tempHist,                           # (SPLOM | layeredHist) & tempHist
  data=weather,
  title='Seattle Weather Dashboard'   # 차트 전체 제목
).transform_filter(
  'datum.location == "Seattle"'
).resolve_legend(
  color='independent'
).configure_axis(
  labelAngle=0
)
```





<div id="altair-viz-b3f08e902435449bb247e9ee4cbe0822"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-b3f08e902435449bb247e9ee4cbe0822") {
      outputDiv = document.getElementById("altair-viz-b3f08e902435449bb247e9ee4cbe0822");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}, "axis": {"labelAngle": 0}}, "vconcat": [{"hconcat": [{"repeat": {"column": ["wind", "precipitation", "temp_max"], "row": ["temp_max", "precipitation", "wind"]}, "spec": {"mark": {"type": "point", "filled": true, "opacity": 0.5, "size": 15}, "encoding": {"x": {"field": {"repeat": "column"}, "type": "quantitative"}, "y": {"field": {"repeat": "row"}, "type": "quantitative"}}, "height": 125, "width": 125}}, {"repeat": {"row": ["temp_max", "precipitation", "wind"]}, "spec": {"layer": [{"mark": "bar", "encoding": {"x": {"field": "date", "timeUnit": "month", "title": "Month", "type": "ordinal"}, "y": {"aggregate": "average", "field": {"repeat": "row"}, "type": "quantitative"}}}, {"mark": {"type": "rule", "stroke": "firebrick"}, "encoding": {"y": {"aggregate": "average", "field": {"repeat": "row"}, "type": "quantitative"}}}], "height": 125, "width": 175}}]}, {"facet": {"column": {"field": "weather", "type": "nominal"}}, "spec": {"mark": "bar", "encoding": {"color": {"field": "weather", "scale": {"domain": ["drizzle", "fog", "rain", "snow", "sun"], "range": ["#aec7e8", "#c7c7c7", "#1f77b4", "#9467bd", "#e7ba52"]}, "type": "nominal"}, "x": {"bin": true, "field": "temp_max", "title": "Temperature (\u00b0C)", "type": "quantitative"}, "y": {"aggregate": "count", "type": "quantitative"}}, "height": 100, "width": 115}}], "data": {"url": "https://vega.github.io/vega-datasets/data/weather.csv"}, "resolve": {"legend": {"color": "independent"}}, "title": "Seattle Weather Dashboard", "transform": [{"filter": "datum.location == \"Seattle\""}], "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json"}, {"formatLocale": {"decimal": ".", "thousands": ",", "grouping": [3], "currency": ["\u20a9", ""]}, "timeFormatLocale": {"dateTime": "%Y/%m/%d %a %X", "date": "%Y/%m/%d", "time": "%H:%M:%S", "periods": ["\uc624\uc804", "\uc624\ud6c4"], "days": ["\uc77c\uc694\uc77c", "\uc6d4\uc694\uc77c", "\ud654\uc694\uc77c", "\uc218\uc694\uc77c", "\ubaa9\uc694\uc77c", "\uae08\uc694\uc77c", "\ud1a0\uc694\uc77c"], "shortDays": ["\uc77c", "\uc6d4", "\ud654", "\uc218", "\ubaa9", "\uae08", "\ud1a0"], "months": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"], "shortMonths": ["1\uc6d4", "2\uc6d4", "3\uc6d4", "4\uc6d4", "5\uc6d4", "6\uc6d4", "7\uc6d4", "8\uc6d4", "9\uc6d4", "10\uc6d4", "11\uc6d4", "12\uc6d4"]}, "mode": "vega-lite"});
</script>



- 이 대시보드를 위한 전체적인 구성 모형은 다음과 같다. 

```
vconcat
|- hconcat
|  |- repeat(row=[...], column=[...])
|  |  |- splom base chart
|  |- repeat(row=[...])
|     |- layer
|        |- layeredHist base chart 1
|        |- layeredHist base chart 2
|        |- layeredHist base chart 3
|- facet(column='weather')
   |- tempHist base chart
```
- 대시보드에는 레이아웃을 개선하기 위한 약간의 맞춤형 설정이 포함되었다.
  - 차트 `width`와 `height` 속성을 조절하여, 정렬을 맞추었고, 전체 화면 크기에 맞추었다. 
  - `resolve_legend(color='independent')`를 추가하여, 하단의 온도 막대그래프에 대한 색상 범례로 처리하였다.  
    이렇게 하지 않으면, 범례가 대시보드 전체에 대한 것이 될 것이다. 
  - `configure_axis(labelAngle=0)`를 추가하여, 모든 축에서 레이블 회전을 방지하였다.  
    이렇게 해야 SPLOM 내부의 산점도와 우측의 월별 막대그래프가 적절하게 정렬된다. 
- 이렇게 조절한 사항들을 제거하거나 수정하여 대시보드 레이아웃이 어덯게 변하는지 살펴보라. 
- 이 대시보드는 다른 도시에 관한 데이터를 보여주기 위하여 재사용 가능하다.  
  시애틀 대신에 뉴욕의 기상 패턴을 보여주는 대시보드로 수정해 보라. 

## 7. 요약

- 하위 플롯의 간격 및 헤더 레이블 등에 관한 조정을 포함하는  
  다중-뷰 구성에 관한 더 상세한 내용에 대해서는 [Altair Compound Charts documentation](https://altair-viz.github.io/user_guide/compound_charts.html) 자료를 참고하라. 
- 지금까지 다중 뷰 구성 방법을 공부하였다.  
  - 통계적 데이터 시각화 기법과 함께 사용된다면, 다중 뷰를 통하여 상호작용적 다차원 탐색을 수행할 수 있다.
  - 예를 들어서 **연동되는 선택**(**linked selections**)을 활용하여,  
    어느 한쪽 뷰에서 데이터 점들을 선택하여 강조할 때,  
    다른 뷰에서 대응되는 데이터 점들이 실시간으로 연동되어 강조되는 시각화를 완성할 수 있다.
- 6장에서는 개별적인 플롯이나 다중-뷰 구성에서  
  **상호작용적 선택**(**interactive selections**)을 가능하게 해주는 시각화 기법을 공부하자. 
